# ç®€åŒ–ç‰ˆOneBotæ¶ˆæ¯å¤„ç†å™¨

è¿™é‡Œæä¾›äº†ä¸‰ä¸ªç®€åŒ–ç‰ˆçš„OneBotæœåŠ¡å™¨ï¼Œä¸“é—¨ç”¨äºå¤„ç†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯å†…å®¹å’Œå‘é€è€…ä¿¡æ¯ã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

### 1. `message_viewer.py` - æ¶ˆæ¯æŸ¥çœ‹å™¨ï¼ˆæ¨èç”¨äºè°ƒè¯•ï¼‰
- ğŸ” **åŠŸèƒ½**: æ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯è¯¦ç»†ä¿¡æ¯
- ğŸ‘ï¸ **ç”¨é€”**: è°ƒè¯•å’ŒæŸ¥çœ‹NapCatæ¨é€çš„æ¶ˆæ¯æ ¼å¼
- ğŸ“‹ **è¾“å‡º**: æ ¼å¼åŒ–æ˜¾ç¤ºæ¶ˆæ¯å†…å®¹ã€å‘é€è€…ä¿¡æ¯ç­‰

### 2. `message_handler.py` - æ¶ˆæ¯å¤„ç†å™¨ï¼ˆæ¨èç”¨äºå®é™…ä½¿ç”¨ï¼‰
- ğŸ¤– **åŠŸèƒ½**: å¤„ç†æ¶ˆæ¯å¹¶æ”¯æŒè‡ªåŠ¨å›å¤
- âš¡ **ç‰¹æ€§**: æ”¯æŒå‘½ä»¤å¤„ç†ã€å…³é”®è¯å›å¤
- ğŸ”§ **å‘½ä»¤**: `/time`, `/hello`, `/help`
- ğŸ’¬ **å›å¤**: è‡ªåŠ¨è¯†åˆ«"ä½ å¥½"ã€"å¸®åŠ©"ç­‰å…³é”®è¯

### 3. `simple_onebot.py` - åŸºç¡€æ¡†æ¶
- ğŸ—ï¸ **åŠŸèƒ½**: æä¾›åŸºç¡€çš„æ¶ˆæ¯å¤„ç†æ¡†æ¶
- ğŸ”§ **ç”¨é€”**: å¯ä»¥åŸºäºæ­¤è¿›è¡Œè‡ªå®šä¹‰å¼€å‘

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æ¶ˆæ¯æŸ¥çœ‹å™¨ï¼ˆè°ƒè¯•æ¨èï¼‰
```bash
python message_viewer.py
```

**è¾“å‡ºç¤ºä¾‹:**
```
â° æ—¶é—´: 14:30:25
ğŸ’¬ ç§èŠæ¶ˆæ¯
ğŸ‘¤ å‘é€è€…: å¼ ä¸‰ (QQ: 123456789)
ğŸ’­ æ¶ˆæ¯å†…å®¹: ä½ å¥½
ğŸ”§ æ£€æµ‹åˆ°å‘½ä»¤: /help
```

### 2. å¯åŠ¨æ¶ˆæ¯å¤„ç†å™¨ï¼ˆå®é™…ä½¿ç”¨æ¨èï¼‰
```bash
python message_handler.py
```

**åŠŸèƒ½:**
- è‡ªåŠ¨å›å¤"ä½ å¥½"ç­‰å…³é”®è¯
- å¤„ç† `/time`ã€`/hello`ã€`/help` å‘½ä»¤
- å¯ä»¥å‘é€å›å¤åˆ°QQï¼ˆéœ€è¦é…ç½®NapCatä¿¡æ¯ï¼‰

### 3. é…ç½®NapCat

åœ¨ `message_handler.py` ä¸­ä¿®æ”¹é…ç½®ï¼š
```python
NAPCAT_HOST = "localhost"    # NapCatåœ°å€
NAPCAT_PORT = 3000          # NapCatç«¯å£
NAPCAT_TOKEN = "your_token" # ä½ çš„token
```

åœ¨NapCaté…ç½®ä¸­æ·»åŠ æ¨é€åœ°å€ï¼š
```json
{
  "http": {
    "enable": true,
    "postUrls": ["http://localhost:8080/"]
  }
}
```

## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½

### æå–çš„ä¿¡æ¯
```python
user_id = data.get('user_id')           # å‘é€è€…QQå·
message = data.get('raw_message', '')   # æ¶ˆæ¯å†…å®¹
nickname = sender.get('nickname', '')   # å‘é€è€…æ˜µç§°
message_type = data.get('message_type') # private/group
group_id = data.get('group_id')         # ç¾¤å·ï¼ˆç¾¤èŠæ—¶ï¼‰
```

### æ¶ˆæ¯ç±»å‹åˆ¤æ–­
```python
if message_type == 'private':
    # ç§èŠæ¶ˆæ¯
    print(f"ç§èŠ | {nickname}: {message}")
    
elif message_type == 'group':
    # ç¾¤èŠæ¶ˆæ¯
    print(f"ç¾¤èŠ({group_id}) | {nickname}: {message}")
```

### å‘½ä»¤å¤„ç†
```python
if message.startswith('/'):
    command = message[1:].split()[0]
    if command == 'time':
        # å¤„ç†æ—¶é—´å‘½ä»¤
    elif command == 'help':
        # å¤„ç†å¸®åŠ©å‘½ä»¤
```

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
```bash
python test_simple.py
```

æµ‹è¯•åŒ…æ‹¬ï¼š
- âœ… ç§èŠæ¶ˆæ¯å¤„ç†
- âœ… ç¾¤èŠæ¶ˆæ¯å¤„ç†
- âœ… å‘½ä»¤è¯†åˆ«
- âœ… æ— æ•ˆJSONå¤„ç†

## ğŸ“ è‡ªå®šä¹‰å¼€å‘

### æ·»åŠ æ–°å‘½ä»¤
åœ¨ `message_handler.py` çš„ `process_command` æ–¹æ³•ä¸­æ·»åŠ ï¼š

```python
elif command == 'weather':
    reply = "ä»Šå¤©å¤©æ°”ä¸é”™"
    self.send_reply(reply, user_id, group_id, message_type)
```

### æ·»åŠ æ–°å…³é”®è¯
åœ¨ `process_keyword` æ–¹æ³•ä¸­æ·»åŠ ï¼š

```python
elif 'å¤©æ°”' in message:
    reply = "ä»Šå¤©å¤©æ°”å¾ˆå¥½"
    self.send_reply(reply, user_id, group_id, message_type)
```

### ä¿å­˜æ¶ˆæ¯åˆ°æ–‡ä»¶
```python
def save_message(self, user_id, nickname, message):
    with open('messages.txt', 'a', encoding='utf-8') as f:
        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        f.write(f"[{timestamp}] {nickname}({user_id}): {message}\n")
```

## ğŸ”§ æ•…éšœæ’é™¤

### 1. JSONè§£æé”™è¯¯
- âœ… å·²è‡ªåŠ¨å¤„ç†æ§åˆ¶å­—ç¬¦
- âœ… è‡ªåŠ¨å¿½ç•¥è§£æå¤±è´¥çš„æ•°æ®
- âœ… è¯¦ç»†é”™è¯¯æ—¥å¿—è®°å½•

### 2. è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080

# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:8080/
```

### 3. NapCaté…ç½®
ç¡®ä¿NapCatçš„HTTPæ¨é€åŠŸèƒ½å·²å¯ç”¨ï¼Œå¹¶ä¸”æ¨é€åœ°å€æ­£ç¡®ã€‚

## âš¡ æ€§èƒ½ç‰¹ç‚¹

- ğŸš€ **è½»é‡çº§**: åªå¤„ç†å¿…è¦çš„æ¶ˆæ¯ä¿¡æ¯
- ğŸ”’ **ç¨³å®šæ€§**: è‡ªåŠ¨å¤„ç†JSONè§£æé”™è¯¯
- ğŸ“ **ç®€æ´æ€§**: ä¸“æ³¨äºæ¶ˆæ¯å†…å®¹å’Œå‘é€è€…
- ğŸ› ï¸ **æ˜“æ‰©å±•**: ç®€å•çš„ä»£ç ç»“æ„ï¼Œæ˜“äºä¿®æ”¹

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **è°ƒè¯•é˜¶æ®µ**: ä½¿ç”¨ `message_viewer.py` æŸ¥çœ‹æ¶ˆæ¯æ ¼å¼
2. **å¼€å‘é˜¶æ®µ**: åŸºäº `message_handler.py` æ·»åŠ åŠŸèƒ½
3. **ç”Ÿäº§ç¯å¢ƒ**: æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬

è¿™ä¸‰ä¸ªç®€åŒ–ç‰ˆæœ¬ä¸“é—¨è®¾è®¡ç”¨äºåªå¤„ç†æ¶ˆæ¯å†…å®¹å’Œå‘é€è€…ä¿¡æ¯ï¼Œå»é™¤äº†å¤æ‚çš„åŠŸèƒ½ï¼Œè®©ä½ å¯ä»¥ä¸“æ³¨äºæ ¸å¿ƒçš„æ¶ˆæ¯å¤„ç†é€»è¾‘ã€‚